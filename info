import os
import win32com.client
from pathlib import Path

def convert_xls_to_xlsx_in_folder(folder_path):
    folder = Path(folder_path)
    try:
        excel = win32com.client.DispatchEx('Excel.Application')  # Use DispatchEx for better isolation
        excel.Visible = False

        for file in folder.glob("*.xls"):
            if file.name.startswith('~$'):
                continue

            try:
                wb = excel.Workbooks.Open(str(file))
                new_file = file.with_suffix('.xlsx')
                wb.SaveAs(str(new_file), FileFormat=51)  # 51 = .xlsx
                wb.Close(SaveChanges=False)
                print(f"‚úÖ Converted: {file.name} ‚Üí {new_file.name}")
                file.unlink()
                print(f"üóëÔ∏è Removed original .xls: {file.name}")
            except Exception as e:
                print(f"‚ùå Failed to convert {file.name}: {e}")

        excel.Quit()
    except Exception as e:
        print(f"üî• Excel COM Automation failed: {e}")