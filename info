import os
import win32com.client as win32
from pathlib import Path

def convert_xls_to_xlsx_in_folder(folder_path):
    folder = Path(folder_path)
    excel = win32.gencache.EnsureDispatch('Excel.Application')
    excel.DisplayAlerts = False

    for file in folder.glob("*.xls"):
        if file.name.startswith('~$'):
            continue  # Skip temporary lock files

        try:
            wb = excel.Workbooks.Open(str(file))
            new_file = file.with_suffix('.xlsx')

            wb.SaveAs(str(new_file), FileFormat=51)  # 51 = Excel Workbook (*.xlsx)
            wb.Close(False)
            print(f"‚úÖ Converted: {file.name} ‚Üí {new_file.name}")

            file.unlink()  # Delete original .xls
            print(f"üóëÔ∏è Removed original .xls: {file.name}")
        except Exception as e:
            print(f"‚ùå Failed to convert {file.name}: {e}")

    excel.Quit()