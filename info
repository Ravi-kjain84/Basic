executor.py

import streamlit.web.cli as stcli
import sys, os, subprocess, socket
from datetime import datetime

def resolve_path(filename):
    base_dir = sys._MEIPASS if getattr(sys, 'frozen', False) else os.path.dirname(__file__)
    return os.path.join(base_dir, filename)

def log_launch_info(app_path, port_killed=None, pids_killed=None):
    log_path = os.path.join(os.path.dirname(app_path), "launch_log.txt")
    with open(log_path, "a") as log:
        log.write("\n===== Streamlit EXE Launch =====\n")
        log.write(f"Timestamp       : {datetime.now()}\n")
        log.write(f"Executor Path   : {os.path.abspath(sys.argv[0])}\n")
        log.write(f"Resolved App.py : {app_path}\n")
        log.write(f"Working Dir     : {os.getcwd()}\n")
        if port_killed:
            log.write(f"Port Freed      : {port_killed}\n")
            log.write(f"Killed PIDs     : {', '.join(pids_killed) if pids_killed else 'Unknown'}\n")
        log.write("================================\n")

def free_port(port):
    killed_pids = []
    try:
        s = socket.socket()
        s.bind(("localhost", port))
        s.close()
    except OSError:
        print(f"Port {port} in use. Attempting to kill occupying process(es)...")
        if os.name == 'nt':
            result = subprocess.run(
                f'netstat -aon | findstr :{port}',
                shell=True, capture_output=True, text=True
            )
            lines = result.stdout.strip().splitlines()
            for line in lines:
                parts = line.strip().split()
                if parts and parts[-1].isdigit():
                    pid = parts[-1]
                    killed_pids.append(pid)
                    subprocess.run(f"taskkill /PID {pid} /F", shell=True)
    return killed_pids

if __name__ == "__main__":
    port = 8501
    app_script_path = resolve_path("app.py")
    pids_killed = free_port(port)
    log_launch_info(app_script_path, port_killed=port if pids_killed else None, pids_killed=pids_killed)
    sys.argv = [
        "streamlit", "run", app_script_path,
        # "--server.headless=true",
        f"--server.port={port}",
        "--global.developmentMode=false"
    ]
    os.environ["STREAMLIT_CONFIG_FILE"] = resolve_path(".streamlit/config.toml")
    sys.exit(stcli.main())




app.py


import streamlit as st
from graphviz import Digraph
import sub_page1, sub_page2, sub_page3

st.set_page_config(layout="wide")
query_params = st.query_params
page = query_params.get("page", "🏠 Home")

st.sidebar.title("Go to")
selected = st.sidebar.radio("Navigation", ["🏠 Home", "🤖 GenAI", "✍️ Manual", "📈 Dashboard"], index=["🏠 Home", "🤖 GenAI", "✍️ Manual", "📈 Dashboard"].index(page))

if selected != page:
    st.query_params.page = selected
    st.rerun()

if page == "🤖 GenAI":
    sub_page1.show()
elif page == "✍️ Manual":
    sub_page2.show()
elif page == "📈 Dashboard":
    sub_page3.show()
else:
    st.title("🧭 Flowchart Navigation")
    st.write("Click on a node below to navigate.")
    dot = Digraph()
    dot.node("Home", "🏠 Home", href="?page=🏠 Home")
    dot.node("GenAI", "🤖 GenAI", href="?page=🤖 GenAI")
    dot.node("Manual", "✍️ Manual", href="?page=✍️ Manual")
    dot.node("Dash", "📈 Dashboard", href="?page=📈 Dashboard")
    dot.edges([("Home", "GenAI"), ("Home", "Manual"), ("Home", "Dash")])
    st.graphviz_chart(dot)


sub_page1.py


import streamlit as st
def show():
    if st.button("🔙 Back to Home"):
        st.query_params.page = "🏠 Home"
    st.header("🤖 GenAI Page")
    st.write("Content for 🤖 GenAI Page goes here.")

sub_page2.py

import streamlit as st
def show():
    if st.button("🔙 Back to Home"):
        st.query_params.page = "🏠 Home"
    st.header("✍️ Manual Page")
    st.write("Content for ✍️ Manual Page goes here.")


sub_page3.py


import streamlit as st
def show():
    if st.button("🔙 Back to Home"):
        st.query_params.page = "🏠 Home"
    st.header("📈 Dashboard Page")
    st.write("Content for 📈 Dashboard Page goes here.")
