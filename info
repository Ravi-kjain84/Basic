import os
import win32com.client
from pathlib import Path

def convert_xls_to_xlsx_in_folder(folder_path):
    folder = Path(folder_path)
    try:
        excel = win32com.client.DispatchEx('Excel.Application')
        excel.Visible = False

        for file in folder.glob("*.xls"):
            if file.name.startswith('~$'):
                continue

            try:
                # Define full target path explicitly
                new_file_path = folder / (file.stem + ".xlsx")

                wb = excel.Workbooks.Open(str(file.resolve()))
                wb.SaveAs(str(new_file_path.resolve()), FileFormat=51)
                wb.Close(SaveChanges=False)

                print(f"‚úÖ Converted: {file.name} ‚Üí {new_file_path.name}")
                file.unlink()
                print(f"üóëÔ∏è Removed original .xls: {file.name}")

                # Confirm file was saved
                if not new_file_path.exists():
                    print(f"‚ùå File not saved: {new_file_path}")
                else:
                    print(f"üìÅ File saved at: {new_file_path.resolve()}")

            except Exception as e:
                print(f"‚ùå Failed to convert {file.name}: {e}")

        excel.Quit()

    except Exception as e:
        print(f"üî• Excel COM Automation failed: {e}")