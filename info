import os
import pandas as pd

def convert_xls_to_xlsx(source_folder):
    output_folder = os.path.join(source_folder, "converted_xlsx")
    os.makedirs(output_folder, exist_ok=True)

    for file_name in os.listdir(source_folder):
        if file_name.lower().endswith('.xls') and not file_name.startswith('~$'):
            xls_path = os.path.join(source_folder, file_name)
            xlsx_file_name = os.path.splitext(file_name)[0] + '.xlsx'
            xlsx_path = os.path.join(output_folder, xlsx_file_name)

            try:
                # Read .xls file
                xls = pd.read_excel(xls_path, sheet_name=None, engine='xlrd')  # Load all sheets
                # Write each sheet to .xlsx
                with pd.ExcelWriter(xlsx_path, engine='openpyxl') as writer:
                    for sheet_name, df in xls.items():
                        df.to_excel(writer, sheet_name=sheet_name, index=False)
                print(f"Converted: {file_name} â†’ {xlsx_file_name}")
            except Exception as e:
                print(f"Failed to convert {file_name}: {e}")

# Usage:
convert_xls_to_xlsx(r"C:\Path\To\Your\Folder")